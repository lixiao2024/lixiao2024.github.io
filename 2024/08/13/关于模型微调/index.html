<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>关于模型微调 | 李潇的博客</title><meta name="author" content="Surely"><meta name="copyright" content="Surely"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="2.1 大语言模型介绍大语言模型的概念大语言模型（英文：Large Language Model，缩写LLM），也称大型语言模型，是一种人工智能模型，旨在理解和生成人类语言。 通常，大语言模型 (LLM) 指包含数十亿（Billion或更多）参数的语言模型，这些模型在大量的文本数据上进行训练，例如国外的有GPT-3 、GPT-4、PaLM 、Galactica 和 LLaMA 等，国内的有Chat">
<meta property="og:type" content="article">
<meta property="og:title" content="关于模型微调">
<meta property="og:url" content="http://example.com/2024/08/13/%E5%85%B3%E4%BA%8E%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/index.html">
<meta property="og:site_name" content="李潇的博客">
<meta property="og:description" content="2.1 大语言模型介绍大语言模型的概念大语言模型（英文：Large Language Model，缩写LLM），也称大型语言模型，是一种人工智能模型，旨在理解和生成人类语言。 通常，大语言模型 (LLM) 指包含数十亿（Billion或更多）参数的语言模型，这些模型在大量的文本数据上进行训练，例如国外的有GPT-3 、GPT-4、PaLM 、Galactica 和 LLaMA 等，国内的有Chat">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/813.jpg">
<meta property="article:published_time" content="2024-08-13T14:24:01.000Z">
<meta property="article:modified_time" content="2024-08-13T14:37:29.484Z">
<meta property="article:author" content="Surely">
<meta property="article:tag" content="专业前沿">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/813.jpg"><link rel="shortcut icon" href="/img/heart.png"><link rel="canonical" href="http://example.com/2024/08/13/%E5%85%B3%E4%BA%8E%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/pwa/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/pwa/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/pwa/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/pwa/16.png"/><link rel="mask-icon" href="/pwa/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":50},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '关于模型微调',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-13 22:37:29'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/xxx.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/face.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> Categories</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> Archives</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> Dairy</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> Photos</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movies</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> Comment</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/813.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="李潇的博客"><span class="site-name">李潇的博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> Categories</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> Archives</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> Dairy</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> Photos</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movies</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> Comment</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">关于模型微调</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-13T14:24:01.000Z" title="发表于 2024-08-13 22:24:01">2024-08-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-13T14:37:29.484Z" title="更新于 2024-08-13 22:37:29">2024-08-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="关于模型微调"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="2-1-大语言模型介绍"><a href="#2-1-大语言模型介绍" class="headerlink" title="2.1 大语言模型介绍"></a>2.1 大语言模型介绍</h2><h3 id="大语言模型的概念"><a href="#大语言模型的概念" class="headerlink" title="大语言模型的概念"></a>大语言模型的概念</h3><p><strong>大语言模型（英文：Large Language Model，缩写LLM），</strong>也称大型语言模型，是一种人工智能模型，旨在理解和生成人类语言。</p>
<p>通常，大语言模型 (LLM) 指包含数<strong>十亿</strong>（<strong>Billion</strong>或更多）参数的语言模型，这些模型在大量的文本数据上进行训练，例如国外的有GPT-3 、GPT-4、PaLM 、Galactica 和 LLaMA 等，国内的有ChatGLM、文心一言、通义千问、讯飞星火等。</p>
<h3 id="大模型的能力和特点"><a href="#大模型的能力和特点" class="headerlink" title="大模型的能力和特点"></a><strong>大模型的能力和特点</strong></h3><ol>
<li><strong>大模型的能力</strong></li>
</ol>
<p>大语言模型（LLM）与以前的预训练语言模型（PLM）的主要区别在于其涌现能力。这种能力在小型模型中不明显，但在大型模型中显著。例如：</p>
<ul>
<li><p><strong>上下文学习</strong>：首次由GPT-3引入，允许模型在提供自然语言指令或多个任务示例的情况下，通过理解上下文并生成相应输出来执行任务。</p>
</li>
<li><p><strong>指令遵循</strong>：通过指令微调，LLM可以根据任务指令执行未见过的任务，展示出强大的泛化能力。</p>
</li>
<li><p><strong>逐步推理</strong>：通过”<strong>思维链（Chain of Thought, CoT）</strong>“策略，LLM能够解决多步推理任务，例如数学问题。</p>
</li>
</ul>
<ol start="2">
<li><strong>大模型的特点</strong></li>
</ol>
<ul>
<li><p><strong>巨大的规模</strong>：参数规模达数十亿甚至数千亿，使其能捕捉更多语言知识和复杂语法结构。</p>
</li>
<li><p><strong>预训练和微调</strong>：在大规模无标签文本数据上预训练，然后通过有标签数据微调，适应特定任务。</p>
</li>
<li><p><strong>上下文感知</strong>：具备强大的上下文感知能力，能够理解和生成依赖前文的文本内容。</p>
</li>
<li><p><strong>多语言支持</strong>：支持多种语言，促进跨文化和跨语言的应用。</p>
</li>
<li><p><strong>多模态支持</strong>：一些LLM支持文本、图像和语音的多模态数据。</p>
</li>
<li><p><strong>涌现能力</strong>：在大规模模型中表现出明显的性能提升，能处理更复杂的任务。</p>
</li>
<li><p><strong>多领域应用</strong>：广泛应用于文本生成、自动翻译、信息检索、摘要生成、聊天机器人等多个领域。</p>
</li>
<li><p><strong>伦理和风险问题</strong>：需要谨慎处理生成有害内容、隐私问题和认知偏差等伦理和风险问题。</p>
</li>
</ul>
<h2 id="2-2-微调介绍"><a href="#2-2-微调介绍" class="headerlink" title="2.2 微调介绍"></a>2.2 微调介绍</h2><h3 id="什么是模型微调-？"><a href="#什么是模型微调-？" class="headerlink" title="*什么是模型微调*？"></a>*<em>什么是模型</em><em><strong>微调</strong></em>*？</h3><p><img src="/img/813-1.png" alt="Lena"></p>
<p>相当于给你一个预训练模型（Pre-trained model），基于这个模型微调（Fine Tune）。</p>
<p><strong>预训练模型就是</strong>已经用数据集训练好了的模型。</p>
<h3 id="两种-Finetune-范式"><a href="#两种-Finetune-范式" class="headerlink" title="两种 Finetune 范式"></a>两种 Finetune 范式</h3><ol>
<li><strong>增量预训练微调 (<strong><strong>Continue PreTraining</strong></strong>)</strong></li>
</ol>
<p>使用场景：让基座模型学习到一些新知识，如某个垂类领域的常识</p>
<ol>
<li><p>训练数据：文章、书籍、代码等</p>
</li>
<li><p>*<em>指令跟随微调 (<em><strong>Supervised Finetuning</strong></em></em>)</p>
</li>
</ol>
<p>使用场景：让模型学会对话模板，根据人类指令进行对话</p>
<p>训练数据：高质量的对话、问答数据</p>
<h3 id="为什么要微调？"><a href="#为什么要微调？" class="headerlink" title="为什么要微调？"></a>为什么要微调？</h3><p>相对于从头开始训练(Training a model from scatch)，微调可以省去大量计算资源和计算时间，提高了计算效率,甚至提高准确率。</p>
<p><strong>普通预训练模型</strong>的特点是：用了大型数据集做训练，已经具备了提取浅层基础特征和深层抽象特征的能力。</p>
<p><strong>不做微调</strong>：</p>
<p>（1）从头开始训练，需要大量的数据，计算时间和计算资源。</p>
<p>（2）存在模型不收敛，参数不够优化，准确率低，模型泛化能力低，容易过拟合等风险。</p>
<p><strong>使用微调</strong>：避免了上述可能存在的问题。</p>
<h3 id="什么情况下使用微调？"><a href="#什么情况下使用微调？" class="headerlink" title="什么情况下使用微调？"></a>什么情况下使用微调？</h3><p>（1） 你要使用的数据集和预训练模型的数据集相似</p>
<p>如果不太相似，效果可能就没有那么好了，特征提取是不同的，所以相应的参数训练后也是不同的。</p>
<p>（2） 自己搭建或者使用的模型正确率太低。</p>
<p>（3）数据集相似，但数据集数量太少。</p>
<p>（4）计算资源太少。</p>
<h3 id="不同数据集下使用微调"><a href="#不同数据集下使用微调" class="headerlink" title="不同数据集下使用微调"></a>不同数据集下使用微调</h3><ul>
<li><p>数据集1 - 数据量少，但数据相似度非常高在这种情况下，我们所做的只是修改最后几层或最终的softmax图层的输出类别。</p>
</li>
<li><p>数据集2 - 数据量少，数据相似度低在这种情况下，我们可以冻结预训练模型的初始层（比如k层），并再次训练剩余的（n-k）层。由于新数据集的相似度较低，因此根据新数据集对较高层进行重新训练具有重要意义。</p>
</li>
<li><p>数据集3 - 数据量大，数据相似度低在这种情况下，由于我们有一个大的数据集，我们的神经网络训练将会很有效。但是，由于我们的数据与用于训练我们的预训练模型的数据相比有很大不同。使用预训练模型进行的预测不会有效。因此，最好根据你的数据从头开始训练神经网络（Training from scatch）。</p>
</li>
<li><p>数据集4 - 数据量大，数据相似度高这是理想情况。在这种情况下，预训练模型应该是最有效的。使用模型的最好方法是保留模型的体系结构和模型的初始权重。然后，我们可以使用在预先训练的模型中的权重来重新训练该模型。</p>
</li>
</ul>
<h3 id="微调指导事项"><a href="#微调指导事项" class="headerlink" title="微调指导事项"></a>微调指导事项</h3><p>1.通常的做法是截断预先训练好的网络的最后一层（softmax层），并用与我们自己的问题相关的新的softmax层替换它。例如，ImageNet上预先训练好的网络带有1000个类别的softmax图层。如果我们的任务是对10个类别的分类，则网络的新softmax层将由10个类别组成，而不是1000个类别。然后，我们在网络上运行预先训练的权重。确保执行交叉验证，以便网络能够很好地推广。 2.使用较小的学习率来训练网络。由于我们预计预先训练的权重相对于随机初始化的权重已经相当不错，我们不想过快地扭曲它们太多。通常的做法是使初始学习率比用于从头开始训练（Training from scratch）的初始学习率小10倍。 3. 如果数据集数量过少，我们进来只训练最后一层，如果数据集数量中等，冻结预训练网络的前几层的权重也是一种常见做法。</p>
<blockquote>
<p>这是因为前几个图层捕捉了与我们的新问题相关的通用特征，如曲线和边。我们希望保持这些权重不变。相反，我们会让网络专注于学习后续深层中特定于数据集的特征。</p>
</blockquote>
<h3 id="LoRA"><a href="#LoRA" class="headerlink" title="LoRA"></a>LoRA</h3><p>LoRA是一种高效微调方法，深入了解其原理可参见博客：[<strong><strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/650197598">知乎|深入浅出Lora</a></strong></strong>] 。</p>
<h3 id="LoRA-的优势"><a href="#LoRA-的优势" class="headerlink" title="LoRA 的优势"></a><strong>LoRA 的优势</strong></h3><ul>
<li><p>可以针对不同的下游任务构建小型 LoRA 模块，从而在共享预训练模型参数基础上有效地切换下游任务。</p>
</li>
<li><p>LoRA 使用自适应优化器（Adaptive Optimizer），不需要计算梯度或维护大多数参数的优化器状态，训练更有效、硬件门槛更低。</p>
</li>
<li><p>LoRA 使用简单的线性设计，在部署时将可训练矩阵与冻结权重合并，不存在推理延迟。</p>
</li>
<li><p>LoRA 与其他方法正交，可以组合。</p>
</li>
</ul>
<h3 id="LoRA-的原理"><a href="#LoRA-的原理" class="headerlink" title="LoRA 的原理"></a><strong>LoRA 的原理</strong></h3><p><img src="/img/813-2.png" alt="Lena"></p>
<h2 id="3-1-环境准备"><a href="#3-1-环境准备" class="headerlink" title="3.1 环境准备"></a>3.1 环境准备</h2><p>相关库的下载与安装：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install pandas openpyxl</span><br></pre></td></tr></table></figure>

<p>数据加载与抽取</p>
<h2 id="3-2-语文数据处理"><a href="#3-2-语文数据处理" class="headerlink" title="3.2 语文数据处理"></a>3.2 语文数据处理</h2><h3 id="3-2-1-数据加载"><a href="#3-2-1-数据加载" class="headerlink" title="3.2.1 数据加载"></a>3.2.1 数据加载</h3><p>这里我们使用pandas加载xlsx中的数据，这里面我们使用全局匹配，将训练集中的中文点与左侧括号匹配为英文类型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding~</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取Excel文件</span></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;训练集-语文.xlsx&#x27;</span>)</span><br><span class="line">df = df.replace(<span class="string">&#x27;．&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, regex=<span class="literal">True</span>)</span><br><span class="line">df = df.replace(<span class="string">&#x27;（&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, regex=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取第二行（即第三行）“选项”列的内容</span></span><br><span class="line"><span class="comment"># 可以使用loc获取某行的数据</span></span><br><span class="line">second_row_option_content = df.loc[<span class="number">2</span>, <span class="string">&#x27;选项&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示第二行“选项”列的内容</span></span><br><span class="line"><span class="built_in">print</span>(second_row_option_content)</span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-抽取问题"><a href="#3-2-2-抽取问题" class="headerlink" title="3.2.2 抽取问题"></a>3.2.2 抽取问题</h3><p>这里主要是为了抽取题目及答案，并且过滤简答题。大家可以阅读详细的注释理解问题抽取的函数如何工作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">chinese_multiple_choice_questions</span>(<span class="params">questions_with_answers</span>):</span><br><span class="line">    <span class="comment"># 输入的题目文本</span></span><br><span class="line">    text = questions_with_answers</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    question_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;\d+\..*?(?=\d+\.|$)&#x27;</span>, re.DOTALL)</span><br><span class="line">    <span class="comment"># 这一行作用是匹配一个以数字开头、后面跟着一个点字符的字符串，</span></span><br><span class="line">    <span class="comment">#。直到遇到下一个数字和点字符或字符串结束。</span></span><br><span class="line">    choice_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;([A-D])\s*(.*?)(?=[A-D]|$|\n)&#x27;</span>, re.DOTALL)</span><br><span class="line">    <span class="comment"># 这一行作用是匹配一个以字母[A到D]开头、后面跟着一个点字符的字符串，</span></span><br><span class="line">    <span class="comment">#直到遇到下一个[A到D]或字符串结束。</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 找到所有问题</span></span><br><span class="line">    questions = question_pattern.findall(text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化选择题和简答题列表</span></span><br><span class="line">    multiple_choice_questions = []</span><br><span class="line">    short_answer_questions = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 处理每个问题</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">id</span>,question <span class="keyword">in</span> <span class="built_in">enumerate</span>(questions):</span><br><span class="line">        <span class="comment"># 这里取到的question，如果是选择题会带着选择题的选项。</span></span><br><span class="line">        <span class="comment"># 检查是否是选择题 因为选择题内有ABCD这样的选项</span></span><br><span class="line">        <span class="keyword">if</span> re.search(<span class="string">r&#x27;[A-D]&#x27;</span>, question):</span><br><span class="line">            <span class="comment"># 如果有选项，提取出选项的内容</span></span><br><span class="line">            choices = choice_pattern.findall(question)</span><br><span class="line">            <span class="comment"># 这里提取了题目的内容，因为每个题目都会有一个打分的（X分）这样的标记</span></span><br><span class="line">            <span class="comment"># 以左括号为目标，截取选择题选项中的内容</span></span><br><span class="line">            question_text = re.split(<span class="string">r&#x27;\n&#x27;</span>, question.split(<span class="string">&#x27;(&#x27;</span>)[<span class="number">0</span>])[<span class="number">0</span>]</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            pattern_question = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(\d+)\.(.*)&#x27;</span>)</span><br><span class="line">            <span class="comment"># 这里清洗了选择题的编号，重新用循环中的id进行编号。</span></span><br><span class="line">            <span class="comment"># 如果不做这一步可以发现给定的数据中编号是乱序的。</span></span><br><span class="line">            matches_question = <span class="built_in">str</span>(<span class="built_in">id</span>+<span class="number">1</span>)+<span class="string">&#x27;.&#x27;</span>+ pattern_question.findall(question_text)[<span class="number">0</span>][<span class="number">1</span>] <span class="comment"># 取出问题后重排序</span></span><br><span class="line">            <span class="comment"># print(str(id+1)+&#x27;.&#x27;+matches_question)</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 这里我们实现声明好了存储的列表</span></span><br><span class="line">            <span class="comment"># 将每个问题和选项以字典的形式存入方便我们处理</span></span><br><span class="line">            multiple_choice_questions.append(&#123;</span><br><span class="line">                <span class="string">&#x27;question&#x27;</span>: matches_question,</span><br><span class="line">                <span class="string">&#x27;choices&#x27;</span>: choices</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 大家可以想想这里怎么用？</span></span><br><span class="line">            short_answer_questions.append(question.strip())</span><br><span class="line">    <span class="comment"># 最后我们返回抽取后的选择题字典列表</span></span><br><span class="line">    <span class="keyword">return</span> multiple_choice_questions</span><br></pre></td></tr></table></figure>

<h3 id="3-2-3-抽取问题的结果"><a href="#3-2-3-抽取问题的结果" class="headerlink" title="3.2.3 抽取问题的结果"></a>3.2.3 抽取问题的结果</h3><p>这里我们抽取刚才我们拿到的选择题的答案部分。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">chinese_multiple_choice_answers</span>(<span class="params">questions_with_answers</span>):</span><br><span class="line">   <span class="comment"># 首先清洗输入字段，因为答案字段中的格式不统一，清洗后便于统一处理。</span></span><br><span class="line">   <span class="comment"># 这里删除了所有的换行和空格</span></span><br><span class="line">    questions_with_answers = questions_with_answers.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># print(questions_with_answers)</span></span><br><span class="line">    <span class="comment"># 使用正则表达式匹配答案</span></span><br><span class="line">    <span class="comment"># 这里我们主要使用第一个匹配 一个数字+点+字母ABCD之间一个</span></span><br><span class="line">    choice_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(\d+)\.([A-Z]+)&#x27;</span>)</span><br><span class="line">    <span class="comment"># 下面这句匹配的是简答题答案~  目前可以忽略</span></span><br><span class="line">    short_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(\d+)\.([^A-Z]+)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 找到所有匹配的答案</span></span><br><span class="line">    choice_matches = choice_pattern.findall(questions_with_answers)</span><br><span class="line">    short_matches = short_pattern.findall(questions_with_answers)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将匹配结果转换为字典</span></span><br><span class="line">    choice_answers = &#123;<span class="built_in">int</span>(index): answer <span class="keyword">for</span> index, answer <span class="keyword">in</span> choice_matches&#125;</span><br><span class="line">    short_answers = &#123;<span class="built_in">int</span>(index): answer <span class="keyword">for</span> index, answer <span class="keyword">in</span> short_matches&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 按序号重新排序</span></span><br><span class="line">    sorted_choice_answers = <span class="built_in">sorted</span>(choice_answers.items())</span><br><span class="line">    sorted_short_answers = <span class="built_in">sorted</span>(short_answers.items())</span><br><span class="line">    </span><br><span class="line">    answers = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出结果</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># print(&quot;选择题答案：&quot;)</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sorted_choice_answers)):</span><br><span class="line">    <span class="comment"># 这里我们也将重新编号号的答案作为返回，返回的是一个列表，方便与问题字典列表匹配~</span></span><br><span class="line">        answers.append(<span class="string">f&quot;<span class="subst">&#123;<span class="built_in">id</span>+<span class="number">1</span>&#125;</span>. <span class="subst">&#123;sorted_choice_answers[<span class="built_in">id</span>][<span class="number">1</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> answers</span><br></pre></td></tr></table></figure>

<p><img src="/img/813-3.png" alt="Lena"></p>
<p>这里是一个样例~</p>
<h3 id="3-2-4-prompt设计"><a href="#3-2-4-prompt设计" class="headerlink" title="3.2.4 prompt设计"></a>3.2.4 prompt设计</h3><p>正如我们1.4介绍的，我们使用要求+阅读材料组成prompt，作为input部分。</p>
<p>我们看看代码如何实现？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_prompt_cn</span>(<span class="params">text</span>):</span><br><span class="line">    prompt = <span class="string">f&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    你是⼀个⾼考选择题出题专家，你出的题有⼀定深度，你将根据阅读文本，出4道单项选择题，包含题目选项，以及对应的答案，注意：不⽤给出原文，每道题由1个问题和4个选项组成，仅存在1个正确答案，请严格按照要求执行。 阅读文本主要是中文，你出的题目需要满足以下要点，紧扣文章内容且题干和答案为中文：</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ### 回答要求</span></span><br><span class="line"><span class="string">    (1)理解文中重要概念的含义</span></span><br><span class="line"><span class="string">    (2)理解文中重要句子的含意</span></span><br><span class="line"><span class="string">    (3)分析论点、论据和论证方法</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ### 阅读文本</span></span><br><span class="line"><span class="string">    <span class="subst">&#123;text&#125;</span></span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> prompt   </span><br></pre></td></tr></table></figure>

<p>可以看到代码里面首先对大模型做了声明，声明如下：</p>
<p><code>你是⼀个⾼考选择题出题专家，你出的题有⼀定深度，你将根据阅读文本，出4道单项选择题，包含题目选项，以及对应的答案，注意：不⽤给出原文，每道题由1个问题和4个选项组成，仅存在1个正确答案，请严格按照要求执行。 阅读文本主要是中文，你出的题目需要满足以下要点，紧扣文章内容且题干和答案为中文：</code></p>
<p>这里是官方的声明，不建议修改~</p>
<p>接下来是要求部分：（这里建议大家根据出题要求做修改尝试~）</p>
<p><code>### 回答要求</code></p>
<p><code>(1)理解文中重要概念的含义</code></p>
<p><code>(2)理解文中重要句子的含意</code></p>
<p><code>(3)分析论点、论据和论证方法</code></p>
<p>最后是阅读材料，这里其实是我们传入的阅读材料参数。</p>
<p><code>### 阅读文本</code></p>
<p><code>&#123;text&#125;</code></p>
<h3 id="3-2-5-中文数据处理主函数"><a href="#3-2-5-中文数据处理主函数" class="headerlink" title="3.2.5 中文数据处理主函数"></a>3.2.5 中文数据处理主函数</h3><p>这段代码将input与output部分进行组合，按照列表序号一一对应~</p>
<p>可以看看注释中的实现细节~</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">process_cn</span>(<span class="params">df</span>): </span><br><span class="line">    <span class="comment"># 定义好返回列表</span></span><br><span class="line">    res_input = []</span><br><span class="line">    res_output = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(df)):</span><br><span class="line">        <span class="comment"># 逐个遍历每行的选项、答案、阅读文本的内容</span></span><br><span class="line">        data_options = df.loc[<span class="built_in">id</span>, <span class="string">&#x27;选项&#x27;</span>]</span><br><span class="line">        data_answers = df.loc[<span class="built_in">id</span>,<span class="string">&#x27;答案&#x27;</span>]</span><br><span class="line">        data_prompt = df.loc[<span class="built_in">id</span>,<span class="string">&#x27;阅读文本&#x27;</span>]</span><br><span class="line">        <span class="comment"># 处理选项部分，抽取出选择题题目及选项</span></span><br><span class="line">        data_options = chinese_multiple_choice_questions(data_options)</span><br><span class="line">        <span class="comment"># 处理答案部分，抽取出选择题答案</span></span><br><span class="line">        data_answers = chinese_multiple_choice_answers(data_answers)</span><br><span class="line">        <span class="comment"># 抽取阅读材料组合成input内容</span></span><br><span class="line">        data_prompt = get_prompt_cn(data_prompt)</span><br><span class="line">        <span class="comment"># print(data_options)</span></span><br><span class="line">        <span class="comment"># print(data_answers)</span></span><br><span class="line">        <span class="comment"># 做数据验证，因为训练数据格式不能确定每组数据都能被正常处理（会有一部分处理失败）</span></span><br><span class="line">        <span class="comment"># 我们验证一下两个列表的长度 如果相同代表数据处理正确</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(data_answers)==<span class="built_in">len</span>(data_options)):</span><br><span class="line">            <span class="comment"># 定义output的数据字符串</span></span><br><span class="line">            res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="comment"># 处理选择题目中的每个数据，逐个拼入到output字符串</span></span><br><span class="line">            <span class="keyword">for</span> id_,question <span class="keyword">in</span> <span class="built_in">enumerate</span>(data_options):</span><br><span class="line">            <span class="comment"># 首先放入题目</span></span><br><span class="line">                res += <span class="string">f&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"><span class="subst">&#123;question[<span class="string">&#x27;question&#x27;</span>]&#125;</span>?</span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span>+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">                <span class="comment"># 然后找到选择题的每个选项，进行choices列表循环</span></span><br><span class="line">                <span class="keyword">for</span> choise <span class="keyword">in</span> question[<span class="string">&#x27;choices&#x27;</span>]:</span><br><span class="line">                <span class="comment"># 逐个将选项拼接到字符串</span></span><br><span class="line">                    res = res+ choise[<span class="number">0</span>] + choise[<span class="number">1</span>]+ <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">                <span class="comment">#  最后将答案拼接到每个选择题的最后</span></span><br><span class="line">                <span class="comment"># 以 答案：题号.选项的格式</span></span><br><span class="line">                res = res + <span class="string">&#x27;答案:&#x27;</span> + <span class="built_in">str</span>(data_answers[id_].split(<span class="string">&#x27;.&#x27;</span>)[-<span class="number">1</span>])  + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            <span class="comment"># 最后将处理得到的input、output数据存入到列表</span></span><br><span class="line">            res_output.append(res)</span><br><span class="line">            res_input.append(data_prompt)</span><br><span class="line">        <span class="comment"># break</span></span><br><span class="line">    <span class="keyword">return</span> res_input,res_output</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h2 id="3-3-英文数据处理"><a href="#3-3-英文数据处理" class="headerlink" title="3.3 英文数据处理"></a>3.3 英文数据处理</h2><h3 id="3-3-1-数据加载"><a href="#3-3-1-数据加载" class="headerlink" title="3.3.1 数据加载"></a>3.3.1 数据加载</h3><p>和中文一样。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding~</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取Excel文件</span></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;训练集-英语.xlsx&#x27;</span>)</span><br><span class="line"><span class="comment"># 英文数据处理中有一部分ocr识别的题目，这种题目中看上去是字母A，但是实际为俄文的字母，，</span></span><br><span class="line"><span class="comment"># 所以开始使用全局匹配做了清洗……</span></span><br><span class="line">df = df.replace(<span class="string">&#x27;．&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, regex=<span class="literal">True</span>).replace(<span class="string">&#x27;А.&#x27;</span>, <span class="string">&#x27;A.&#x27;</span>, regex=<span class="literal">True</span>).replace(<span class="string">&#x27;В.&#x27;</span>, <span class="string">&#x27;B.&#x27;</span>, regex=<span class="literal">True</span>).replace(<span class="string">&#x27;С.&#x27;</span>, <span class="string">&#x27;C.&#x27;</span>, regex=<span class="literal">True</span>).replace(<span class="string">&#x27;D.&#x27;</span>, <span class="string">&#x27;D.&#x27;</span>, regex=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># df = df.replace(&#x27;（&#x27;, &#x27;(&#x27;, regex=True)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取第二行（即第三行）“选项”列的内容</span></span><br><span class="line">second_row_option_content = df.loc[<span class="number">0</span>, <span class="string">&#x27;选项&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示第二行“选项”列的内容</span></span><br><span class="line"><span class="built_in">print</span>(second_row_option_content)</span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-抽取问题"><a href="#3-3-2-抽取问题" class="headerlink" title="3.3.2 抽取问题"></a>3.3.2 抽取问题</h3><p>英文问题数据相对标准，但是也有不少小问题。比如ABCD的顺序可能是ACBD。我们看看这些如何解决。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例文本</span></span><br><span class="line">text = second_row_option_content</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_questions</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="comment"># 数据清洗，将所有换行改为两个空格方便统一处理</span></span><br><span class="line">    text = text.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;  &#x27;</span>)+<span class="string">&#x27;  &#x27;</span></span><br><span class="line">    <span class="comment"># print(text)</span></span><br><span class="line">    <span class="comment"># 正则表达式模式</span></span><br><span class="line">    <span class="comment"># 通过匹配以数字开头然后带一个点，为题干</span></span><br><span class="line">    <span class="comment"># 然后抽取选项A  以A开头 后面带一个点 最后以两个空格结尾</span></span><br><span class="line">    <span class="comment"># 为什么是两个空格？部分数据换行时为换行符，我们已经换成了两个空格，有些是以多个空格分割，我们默认为两个空格</span></span><br><span class="line">    <span class="comment"># 接着匹配B C D选项内容</span></span><br><span class="line">    <span class="comment"># 最后有一个</span></span><br><span class="line">    pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(\d+\..*?)(A\..*?\s&#123;2&#125;)([B-D]\..*?\s&#123;2&#125;)([B-D]\..*?\s&#123;2&#125;)(D\..*?\s&#123;2&#125;)&#x27;</span>, re.DOTALL)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查找所有匹配项</span></span><br><span class="line">    matches = pattern.findall(text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 存储结果的字典列表</span></span><br><span class="line">    questions_dict_list = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 打印结果</span></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches:</span><br><span class="line">        question, option1, option2, option3, option4 = <span class="keyword">match</span></span><br><span class="line">        pattern_question = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(\d+)\.(.*)&#x27;</span>)</span><br><span class="line">        <span class="comment"># 第一个为选择题的题目 提前存到question_text </span></span><br><span class="line">        question_text = pattern_question.findall(question.strip())[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 提取选项字母和内容</span></span><br><span class="line">        options = &#123;option1[<span class="number">0</span>]: option1, option2[<span class="number">0</span>]: option2, option3[<span class="number">0</span>]: option3, option4[<span class="number">0</span>]: option4&#125;</span><br><span class="line">        </span><br><span class="line">        question_dict = &#123;</span><br><span class="line">            <span class="string">&#x27;question&#x27;</span>: question_text,</span><br><span class="line">            <span class="comment"># 这一步就是防止ACBD这种乱序，我们进行重新匹配，将可能是ACBD的数据以首字母按位置排好号</span></span><br><span class="line">            <span class="string">&#x27;options&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;A&#x27;</span>: options.get(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip(),</span><br><span class="line">                <span class="string">&#x27;B&#x27;</span>: options.get(<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip(),</span><br><span class="line">                <span class="string">&#x27;C&#x27;</span>: options.get(<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip(),</span><br><span class="line">                <span class="string">&#x27;D&#x27;</span>: options.get(<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        questions_dict_list.append(question_dict)</span><br><span class="line">    <span class="comment"># 最后获得</span></span><br><span class="line">    <span class="keyword">return</span> questions_dict_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用函数并打印结果</span></span><br><span class="line">questions = get_questions(text)</span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> questions:</span><br><span class="line">    <span class="built_in">print</span>(q)</span><br></pre></td></tr></table></figure>

<h3 id="3-3-3-抽取问题的结果"><a href="#3-3-3-抽取问题的结果" class="headerlink" title="3.3.3 抽取问题的结果"></a>3.3.3 抽取问题的结果</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先做数据清洗，将空格、换行符及点都删除</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_whitespace_and_newlines</span>(<span class="params">input_string</span>):</span><br><span class="line">    <span class="comment"># 使用str.replace()方法删除空格和换行符</span></span><br><span class="line">    result = input_string.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例文本</span></span><br><span class="line">text = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">32. B. The underlying logic of the effect.                                                   33.D. estimates were not fully independent.</span></span><br><span class="line"><span class="string">34.C. The discussion process.            35.D. Approving.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_answers</span>(<span class="params">text</span>):</span><br><span class="line">    text = remove_whitespace_and_newlines(text)</span><br><span class="line">    <span class="comment"># 正则表达式模式</span></span><br><span class="line">    <span class="comment"># 这里是一个数字加一个A-D的大写字母表示为答案区域，因为有些答案中有解释，这样的匹配规则可以尽可能匹配到答案</span></span><br><span class="line">    pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(\d)\s*([A-D])&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查找所有匹配项</span></span><br><span class="line">    matches = pattern.findall(text)</span><br><span class="line">    res = []</span><br><span class="line">    <span class="comment"># 打印结果</span></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches:</span><br><span class="line">        number_dot, first_letter = <span class="keyword">match</span></span><br><span class="line">        res.append(first_letter)</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>

<h3 id="3-3-4-prompt设计"><a href="#3-3-4-prompt设计" class="headerlink" title="3.3.4 prompt设计"></a>3.3.4 prompt设计</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_prompt_en</span>(<span class="params">text</span>):</span><br><span class="line">    prompt = <span class="string">f&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    你是⼀个⾼考选择题出题专家，你出的题有⼀定深度，你将根据阅读文本，出4道单项选择题，包含题目选项，以及对应的答案，注意：不⽤给出原文，每道题由1个问题和4个选项组成，仅存在1个正确答案，请严格按照要求执行。</span></span><br><span class="line"><span class="string">The reading text is mainly in English. The questions and answers you raised need to be completed in English for at least the following points:</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ### 回答要求</span></span><br><span class="line"><span class="string">    (1)Understanding the main idea of the main idea.</span></span><br><span class="line"><span class="string">    (2)Understand the specific information in the text.</span></span><br><span class="line"><span class="string">    (3)infering the meaning of words and phrases from the context</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ### 阅读文本</span></span><br><span class="line"><span class="string">    <span class="subst">&#123;text&#125;</span></span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> prompt   </span><br></pre></td></tr></table></figure>

<p>可以看到代码里面首先对大模型做了声明，声明如下：</p>
<p><code>你是⼀个⾼考选择题出题专家，你出的题有⼀定深度，你将根据阅读文本，出4道单项选择题，包含题目选项，以及对应的答案，注意：不⽤给出原文，每道题由1个问题和4个选项组成，仅存在1个正确答案，请严格按照要求执行。</code></p>
<p><code>The reading text is mainly in English. The questions and answers you raised need to be completed in English for at least the following points:</code></p>
<p>这里是官方的声明，不建议修改~</p>
<p>接下来是要求部分：（这里建议大家根据出题要求做修改尝试~）</p>
<p><code>### 回答要求</code></p>
<p><code>(1)Understanding the main idea of the main idea.</code></p>
<p><code>(2)Understand the specific information in the text.</code></p>
<p><code>(3)infering the meaning of words and phrases from the context</code></p>
<p>最后是阅读材料，这里其实是我们传入的阅读材料参数。</p>
<p><code>### 阅读文本</code></p>
<p><code>&#123;text&#125;</code></p>
<h3 id="3-3-5-英文数据处理主函数"><a href="#3-3-5-英文数据处理主函数" class="headerlink" title="3.3.5 英文数据处理主函数"></a>3.3.5 英文数据处理主函数</h3><p>这里大家可以参考中文部分对比学习，相比中文简单很多~</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">process_en</span>(<span class="params">df</span>): </span><br><span class="line">    res_input = []</span><br><span class="line">    res_output = []</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(df)):</span><br><span class="line">        data_options = df.loc[<span class="built_in">id</span>, <span class="string">&#x27;选项&#x27;</span>]</span><br><span class="line">        data_answers = df.loc[<span class="built_in">id</span>,<span class="string">&#x27;答案&#x27;</span>]</span><br><span class="line">        data_prompt = df.loc[<span class="built_in">id</span>,<span class="string">&#x27;阅读文本&#x27;</span>]</span><br><span class="line">        data_options = get_questions(data_options)</span><br><span class="line">        data_answers = get_answers(data_answers)</span><br><span class="line">        data_prompt = get_prompt_en(data_prompt)</span><br><span class="line">        <span class="comment"># print(data_options)</span></span><br><span class="line">        <span class="comment"># print(data_answers)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(data_answers)==<span class="built_in">len</span>(data_options)):</span><br><span class="line">            res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> <span class="built_in">id</span>,question <span class="keyword">in</span> <span class="built_in">enumerate</span>(data_options):</span><br><span class="line">                res += <span class="string">f&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                <span class="subst">&#123;<span class="built_in">id</span>+<span class="number">1</span>&#125;</span>.<span class="subst">&#123;question[<span class="string">&#x27;question&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">                <span class="subst">&#123;question[<span class="string">&#x27;options&#x27;</span>][<span class="string">&#x27;A&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">                <span class="subst">&#123;question[<span class="string">&#x27;options&#x27;</span>][<span class="string">&#x27;B&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">                <span class="subst">&#123;question[<span class="string">&#x27;options&#x27;</span>][<span class="string">&#x27;C&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">                <span class="subst">&#123;question[<span class="string">&#x27;options&#x27;</span>][<span class="string">&#x27;D&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">                answer:<span class="subst">&#123;data_answers[<span class="built_in">id</span>]&#125;</span></span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span>+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            res_output.append(res)</span><br><span class="line">            res_input.append(data_prompt)</span><br><span class="line">    <span class="keyword">return</span> res_input,res_output</span><br><span class="line">    <span class="comment"># break</span></span><br></pre></td></tr></table></figure>

<h2 id="3-4-数据合并"><a href="#3-4-数据合并" class="headerlink" title="3.4 数据合并"></a>3.4 数据合并</h2><p>因为微调需要150条数据，数据处理后得到有效数据为102，从中文抽取30条，英文抽取20条组成152条数据作为微调数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将两个列表转换为DataFrame</span></span><br><span class="line"></span><br><span class="line">df_new = pd.DataFrame(&#123;<span class="string">&#x27;input&#x27;</span>: cn_input+cn_input[:<span class="number">30</span>]+en_input+en_input[:<span class="number">20</span>], <span class="string">&#x27;output&#x27;</span>: cn_output+cn_output[:<span class="number">30</span>]+en_output+en_output[:<span class="number">20</span>]&#125;)</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Surely</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/08/13/%E5%85%B3%E4%BA%8E%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">http://example.com/2024/08/13/关于模型微调/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">李潇的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%B8%93%E4%B8%9A%E5%89%8D%E6%B2%BF/">专业前沿</a></div><div class="post_share"><div class="social-share" data-image="/img/813.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/08/04/%E5%9F%BA%E4%BA%8ETransformer%E8%A7%A3%E5%86%B3%E6%9C%BA%E5%99%A8%E7%BF%BB%E8%AF%91%E4%BB%BB%E5%8A%A1/" title="基于Transformer解决机器翻译任务"><img class="cover" src="/img/transformer.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">基于Transformer解决机器翻译任务</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/05/29/%E8%B6%85%E7%AE%97%E7%AE%80%E4%BB%8B/" title="超算简介"><img class="cover" src="/img/super.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-29</div><div class="title">超算简介</div></div></a></div><div><a href="/2024/05/22/Web3%E4%BB%8B%E7%BB%8D/" title="Web3介绍"><img class="cover" src="/img/Web3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-22</div><div class="title">Web3介绍</div></div></a></div><div><a href="/2024/05/20/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86NLP/" title="自然语言处理NLP"><img class="cover" src="/img/NLP.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-20</div><div class="title">自然语言处理NLP</div></div></a></div><div><a href="/2024/05/19/%E8%84%91%E6%9C%BA%E6%8E%A5%E5%8F%A3%E5%9C%A8%E7%A5%9E%E7%BB%8F%E5%BA%B7%E5%A4%8D%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/" title="脑机接口在神经康复中的应用"><img class="cover" src="/img/njjk.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-19</div><div class="title">脑机接口在神经康复中的应用</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81ODQyMS8zNDg4NA=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/face.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Surely</div><div class="author-info__description">新的开始，欢迎访问</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/lixiao2024" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1290059235@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.surelylee2048.com.cn" target="_blank" title="博客"><i class="fab fa-algolia"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">2.1 大语言模型介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">大语言模型的概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%83%BD%E5%8A%9B%E5%92%8C%E7%89%B9%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">大模型的能力和特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%BE%AE%E8%B0%83%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">2.2 微调介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83-%EF%BC%9F"><span class="toc-number">2.1.</span> <span class="toc-text">*什么是模型微调*？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8D-Finetune-%E8%8C%83%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">两种 Finetune 范式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%BE%AE%E8%B0%83%EF%BC%9F"><span class="toc-number">2.3.</span> <span class="toc-text">为什么要微调？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E4%BD%BF%E7%94%A8%E5%BE%AE%E8%B0%83%EF%BC%9F"><span class="toc-number">2.4.</span> <span class="toc-text">什么情况下使用微调？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E9%9B%86%E4%B8%8B%E4%BD%BF%E7%94%A8%E5%BE%AE%E8%B0%83"><span class="toc-number">2.5.</span> <span class="toc-text">不同数据集下使用微调</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E8%B0%83%E6%8C%87%E5%AF%BC%E4%BA%8B%E9%A1%B9"><span class="toc-number">2.6.</span> <span class="toc-text">微调指导事项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LoRA"><span class="toc-number">2.7.</span> <span class="toc-text">LoRA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LoRA-%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-number">2.8.</span> <span class="toc-text">LoRA 的优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LoRA-%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">2.9.</span> <span class="toc-text">LoRA 的原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">3.</span> <span class="toc-text">3.1 环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E8%AF%AD%E6%96%87%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">3.2 语文数据处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD"><span class="toc-number">4.1.</span> <span class="toc-text">3.2.1 数据加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E6%8A%BD%E5%8F%96%E9%97%AE%E9%A2%98"><span class="toc-number">4.2.</span> <span class="toc-text">3.2.2 抽取问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-%E6%8A%BD%E5%8F%96%E9%97%AE%E9%A2%98%E7%9A%84%E7%BB%93%E6%9E%9C"><span class="toc-number">4.3.</span> <span class="toc-text">3.2.3 抽取问题的结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-prompt%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.4.</span> <span class="toc-text">3.2.4 prompt设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-%E4%B8%AD%E6%96%87%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%BB%E5%87%BD%E6%95%B0"><span class="toc-number">4.5.</span> <span class="toc-text">3.2.5 中文数据处理主函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E8%8B%B1%E6%96%87%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">3.3 英文数据处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD"><span class="toc-number">5.1.</span> <span class="toc-text">3.3.1 数据加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E6%8A%BD%E5%8F%96%E9%97%AE%E9%A2%98"><span class="toc-number">5.2.</span> <span class="toc-text">3.3.2 抽取问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E6%8A%BD%E5%8F%96%E9%97%AE%E9%A2%98%E7%9A%84%E7%BB%93%E6%9E%9C"><span class="toc-number">5.3.</span> <span class="toc-text">3.3.3 抽取问题的结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-4-prompt%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.4.</span> <span class="toc-text">3.3.4 prompt设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-5-%E8%8B%B1%E6%96%87%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%BB%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.</span> <span class="toc-text">3.3.5 英文数据处理主函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E6%95%B0%E6%8D%AE%E5%90%88%E5%B9%B6"><span class="toc-number">6.</span> <span class="toc-text">3.4 数据合并</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/13/%E5%85%B3%E4%BA%8E%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/" title="关于模型微调"><img src="/img/813.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="关于模型微调"/></a><div class="content"><a class="title" href="/2024/08/13/%E5%85%B3%E4%BA%8E%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/" title="关于模型微调">关于模型微调</a><time datetime="2024-08-13T14:24:01.000Z" title="发表于 2024-08-13 22:24:01">2024-08-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/04/%E5%9F%BA%E4%BA%8ETransformer%E8%A7%A3%E5%86%B3%E6%9C%BA%E5%99%A8%E7%BF%BB%E8%AF%91%E4%BB%BB%E5%8A%A1/" title="基于Transformer解决机器翻译任务"><img src="/img/transformer.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于Transformer解决机器翻译任务"/></a><div class="content"><a class="title" href="/2024/08/04/%E5%9F%BA%E4%BA%8ETransformer%E8%A7%A3%E5%86%B3%E6%9C%BA%E5%99%A8%E7%BF%BB%E8%AF%91%E4%BB%BB%E5%8A%A1/" title="基于Transformer解决机器翻译任务">基于Transformer解决机器翻译任务</a><time datetime="2024-08-04T12:33:22.000Z" title="发表于 2024-08-04 20:33:22">2024-08-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/04/NLP%E5%85%A5%E9%97%A8/" title="NLP入门"><img src="/img/8-4nlp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NLP入门"/></a><div class="content"><a class="title" href="/2024/08/04/NLP%E5%85%A5%E9%97%A8/" title="NLP入门">NLP入门</a><time datetime="2024-08-04T12:31:52.000Z" title="发表于 2024-08-04 20:31:52">2024-08-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/29/%E8%B6%85%E7%AE%97%E7%AE%80%E4%BB%8B/" title="超算简介"><img src="/img/super.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="超算简介"/></a><div class="content"><a class="title" href="/2024/05/29/%E8%B6%85%E7%AE%97%E7%AE%80%E4%BB%8B/" title="超算简介">超算简介</a><time datetime="2024-05-29T00:32:02.000Z" title="发表于 2024-05-29 08:32:02">2024-05-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/28/hexo%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/" title="hexo框架原理"><img src="/img/hexokj.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexo框架原理"/></a><div class="content"><a class="title" href="/2024/05/28/hexo%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/" title="hexo框架原理">hexo框架原理</a><time datetime="2024-05-28T14:01:42.000Z" title="发表于 2024-05-28 22:01:42">2024-05-28</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/813.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Surely</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !true) {
  if (true) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><div class="aplayer no-destroy" data-id="60198" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="I,love,u" data-fontsize="15px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>